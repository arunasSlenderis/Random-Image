!function(e){function i(t){if(s[t])return s[t].exports;var d=s[t]={exports:{},id:t,loaded:!1};return e[t].call(d.exports,d,d.exports,i),d.loaded=!0,d.exports}var s={};return i.m=e,i.c=s,i.p="/",i(0)}([function(e,i,s){e.exports=s(3)},function(e,i,s){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var d=s(8),a=t(d),n=s(2),l=t(n),r=process.env.NODE_ENV||"development",o=void 0;o="production"===r?new a["default"](process.env.DATABASE_URL,{dialect:"postgres"}):new a["default"]("random_images","root","");var u={};u.like=o["import"](l["default"].resolve("./server/database/models/like.js")),u.usersIP=o["import"](l["default"].resolve("./server/database/models/usersIp.js")),u.Sequelize=a["default"],u.connection=o,i["default"]=u},function(e,i){e.exports=require("path")},function(e,i,s){"use strict";function t(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s]);return i["default"]=e,i}function d(e){return e&&e.__esModule?e:{"default":e}}s(9);var a=s(7),n=d(a),l=s(5),r=d(l),o=s(1),u=d(o),c=s(4),f=t(c),p=(0,n["default"])(),k=process.env.PORT||3e3;p.use(n["default"]["static"]("./dist")),p.use(r["default"].urlencoded({extended:!0})),p.use(r["default"].json()),p.all("/*",f.corsFix),p.get("/",f.home),p.post("/info",f.info),u["default"].connection.sync({}).then(function(){p.listen(k,function(e){if(e)throw new Error("Server fault: ",e);console.log("Server is listening on port:",k)})})},function(e,i,s){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0}),i.info=i.home=i.corsFix=void 0;var d=s(2),a=t(d),n=s(6),l=t(n),r=s(1),o=t(r);i.corsFix=function(e,i,s){i.header("Access-Control-Allow-Origin","*"),i.header("Access-Control-Allow-Headers","X-Requested-With"),s()},i.home=function(e,i){i.sendFile(a["default"].resolve("./src/index.html"))},i.info=function(e,i){var s=e.body.imageId,t=e.body.ip,d=e.body.likePressed,a=e.body.dislikePressed;o["default"].like.findOne({where:{imageId:s}}).then(function(e){var n={likes:e?e.dataValues.likes:"0",dislikes:e?e.dataValues.dislikes:"0",views:e?e.dataValues.views:"1",liked:!1,disliked:!1};e?o["default"].usersIP.findAll({where:{imageId:s}}).then(function(s){var l=s.find(function(e){return t===e.dataValues.ip});l&&(n.liked=l.dataValues.liked,n.disliked=l.dataValues.disliked);var r=l.dataValues.disliked,o=l.dataValues.liked;o===!1||r===!1?(d&&!r&&(l.update({liked:!0}).then(function(e){n.liked=e.dataValues.liked}),e.update({likes:d?e.dataValues.likes+1:e.dataValues.likes}).then(function(e){n.likes=e.dataValues.likes,i.send(n)})),a&&!o&&(l.update({disliked:!0}).then(function(e){n.disliked=e.dataValues.disliked}),e.update({dislikes:a?e.dataValues.dislikes+1:e.dataValues.dislikes}).then(function(e){n.dislikes=e.dataValues.dislikes,i.send(n)}))):l?i.send(n):e.update({views:e.dataValues.views+1}).then(function(e){n.views=e.dataValues.views,i.send(n)})}):(o["default"].like.create({imageId:s,likes:0,dislikes:0,views:1}),o["default"].usersIP.create({imageId:s,ip:t,liked:!1,disliked:!1}),i.send(n))})["catch"](function(e){console.log(l["default"].red("Error finding image: ",e))})}},function(e,i){e.exports=require("body-parser")},function(e,i){e.exports=require("chalk")},function(e,i){e.exports=require("express")},function(e,i){e.exports=require("sequelize")},function(e,i){e.exports=require("source-map-support/register")}]);
//# sourceMappingURL=server.js.map