!function(e){function i(t){if(s[t])return s[t].exports;var d=s[t]={exports:{},id:t,loaded:!1};return e[t].call(d.exports,d,d.exports,i),d.loaded=!0,d.exports}var s={};return i.m=e,i.c=s,i.p="/",i(0)}([function(e,i,s){e.exports=s(3)},function(e,i,s){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var d=s(8),l=t(d),n=s(2),a=t(n),r=process.env.NODE_ENV||"development",u=void 0;u="production"===r?new l["default"](process.env.DATABASE_URL,{dialect:"postgres"}):new l["default"]("random_images","root","");var o={};o.like=u["import"](a["default"].resolve("./server/database/models/like.js")),o.usersIP=u["import"](a["default"].resolve("./server/database/models/usersIp.js")),o.Sequelize=l["default"],o.connection=u,i["default"]=o},function(e,i){e.exports=require("path")},function(e,i,s){"use strict";function t(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s]);return i["default"]=e,i}function d(e){return e&&e.__esModule?e:{"default":e}}s(9);var l=s(7),n=d(l),a=s(5),r=d(a),u=s(1),o=d(u),c=s(4),f=t(c),k=(0,n["default"])(),p=process.env.PORT||3e3;k.use(n["default"]["static"]("./dist")),k.use(r["default"].urlencoded({extended:!0})),k.use(r["default"].json()),k.all("/*",f.corsFix),k.get("/",f.home),k.post("/info",f.info),o["default"].connection.sync({}).then(function(){k.listen(p,function(e){if(e)throw new Error("Server fault: ",e);console.log("Server is listening on port:",p)})})},function(e,i,s){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0}),i.info=i.home=i.corsFix=void 0;var d=s(2),l=t(d),n=s(6),a=t(n),r=s(1),u=t(r);i.corsFix=function(e,i,s){i.header("Access-Control-Allow-Origin","*"),i.header("Access-Control-Allow-Headers","X-Requested-With"),s()},i.home=function(e,i){i.sendFile(l["default"].resolve("./src/index.html"))},i.info=function(e,i){var s=e.body.imageId,t=e.body.ip,d=e.body.likePressed,l=e.body.dislikePressed;u["default"].like.findOne({where:{imageId:s}}).then(function(e){var n={likes:e?e.dataValues.likes:"0",dislikes:e?e.dataValues.dislikes:"0",views:e?e.dataValues.views:1,liked:null,disliked:null};e?u["default"].usersIP.findAll({where:{imageId:s}}).then(function(a){var r=a.find(function(e){return t===e.dataValues.ip});r||u["default"].usersIP.create({imageId:s,ip:t,liked:!!n.liked&&n.liked,disliked:!!n.disliked&&n.disliked}).then(function(s){e.update({views:e.dataValues.views+1}).then(function(e){n.views=e.dataValues.views,i.send(n)}),r=s});var o=r||r===!1?r.dataValues.disliked:null,c=r||r===!1?r.dataValues.liked:null;c!==!1&&o!==!1||(d&&!o&&(r.update({liked:!0}).then(function(e){n.liked=e.dataValues.liked}),c===!1&&e.update({likes:d?e.dataValues.likes+1:e.dataValues.likes}).then(function(e){n.likes=e.dataValues.likes,i.send(n)})),l&&!c&&(r.update({disliked:!0}).then(function(e){n.disliked=e.dataValues.disliked}),o===!1&&e.update({dislikes:l?e.dataValues.dislikes+1:e.dataValues.dislikes}).then(function(e){n.dislikes=e.dataValues.dislikes,i.send(n)})),d||l||(n.liked=r.dataValues.liked,n.disliked=r.dataValues.disliked,i.send(n)))}):(u["default"].like.create({imageId:s,likes:0,dislikes:0,views:1}),u["default"].usersIP.create({imageId:s,ip:t,liked:!1,disliked:!1}),i.send(n))})["catch"](function(e){console.error(a["default"].red("Error finding image: ",e))})}},function(e,i){e.exports=require("body-parser")},function(e,i){e.exports=require("chalk")},function(e,i){e.exports=require("express")},function(e,i){e.exports=require("sequelize")},function(e,i){e.exports=require("source-map-support/register")}]);
//# sourceMappingURL=server.js.map