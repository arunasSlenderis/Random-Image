!function(e){function i(d){if(s[d])return s[d].exports;var t=s[d]={exports:{},id:d,loaded:!1};return e[d].call(t.exports,t,t.exports,i),t.loaded=!0,t.exports}var s={};return i.m=e,i.c=s,i.p="/",i(0)}([function(e,i,s){e.exports=s(3)},function(e,i){e.exports=require("path")},function(e,i,s){"use strict";function d(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var t=s(8),l=d(t),a=s(1),n=d(a),u=process.env.NODE_ENV||"development",r=void 0;r="production"===u?new l["default"](process.env.DATABASE_URL,{dialect:"postgres"}):new l["default"]("random_images","root","");var o={};o.like=r["import"](n["default"].resolve("./server/database/models/like.js")),o.usersIP=r["import"](n["default"].resolve("./server/database/models/usersIp.js")),o.Sequelize=l["default"],o.connection=r,i["default"]=o},function(e,i,s){"use strict";function d(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s]);return i["default"]=e,i}function t(e){return e&&e.__esModule?e:{"default":e}}s(9);var l=s(7),a=t(l),n=s(5),u=t(n),r=s(1),o=t(r),f=s(2),c=t(f),k=s(4),p=d(k),v=(0,a["default"])(),h=process.env.PORT||3e3;v.set("view engine","jade"),v.use(a["default"]["static"]("./dist")),v.use(u["default"].urlencoded({extended:!0})),v.use(u["default"].json()),v.all("/*",p.corsFix),v.get("/",p.home),v.post("/info",p.info),v.get("/*",function(e,i){i.sendFile(o["default"].resolve("./404.html"))}),v.use(function(e,i,s){s.status(500),s.render("500.jade",e)}),c["default"].connection.sync({}).then(function(){v.listen(h,function(e){if(e)throw new Error("Server fault: ",e);console.log("Server is listening on port:",h)})})},function(e,i,s){"use strict";function d(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0}),i.info=i.home=i.corsFix=void 0;var t=s(1),l=d(t),a=s(6),n=d(a),u=s(2),r=d(u);i.corsFix=function(e,i,s){i.header("Access-Control-Allow-Origin","*"),i.header("Access-Control-Allow-Headers","X-Requested-With"),s()},i.home=function(e,i){i.sendFile(l["default"].resolve("./src/index.html"))},i.info=function(e,i){var s=e.body.imageId,d=e.body.ip,t=e.body.likePressed,l=e.body.dislikePressed,a=e.body.unlikePressed,u=e.body.undislikePressed;r["default"].like.findOne({where:{imageId:s}}).then(function(e){var n={likes:e?e.dataValues.likes:"0",dislikes:e?e.dataValues.dislikes:"0",views:e?e.dataValues.views:1,liked:null,disliked:null};e?r["default"].usersIP.findAll({where:{imageId:s}}).then(function(o){var f=o.find(function(e){return d===e.dataValues.ip});f||r["default"].usersIP.create({imageId:s,ip:d,liked:!!n.liked&&n.liked,disliked:!!n.disliked&&n.disliked}).then(function(s){e.update({views:e.dataValues.views+1}).then(function(e){n.views=e.dataValues.views,i.send(n)}),f=s});var c=f||f===!1?f.dataValues.disliked:null,k=f||f===!1?f.dataValues.liked:null;a&&f&&f.dataValues.liked&&(f.update({liked:!1}).then(function(e){n.liked=e.dataValues.liked}),e.update({likes:e.dataValues.likes-1}).then(function(e){n.likes=e.dataValues.likes})),u&&f&&f.dataValues.disliked&&(f.update({disliked:!1}).then(function(e){n.disliked=e.dataValues.disliked}),e.update({dislikes:e.dataValues.dislikes-1}).then(function(e){n.dislikes=e.dataValues.dislikes})),k!==!1&&c!==!1||(t&&!c&&(f.update({liked:!0}).then(function(e){n.liked=e.dataValues.liked}),k===!1&&e.update({likes:t?e.dataValues.likes+1:e.dataValues.likes}).then(function(e){n.likes=e.dataValues.likes,i.send(n)})),l&&!k&&(f.update({disliked:!0}).then(function(e){n.disliked=e.dataValues.disliked}),c===!1&&e.update({dislikes:l?e.dataValues.dislikes+1:e.dataValues.dislikes}).then(function(e){n.dislikes=e.dataValues.dislikes,i.send(n)})),t||l||(n.liked=f.dataValues.liked,n.disliked=f.dataValues.disliked,i.send(n)))}):(r["default"].like.create({imageId:s,likes:0,dislikes:0,views:1}),r["default"].usersIP.create({imageId:s,ip:d,liked:!1,disliked:!1}),i.send(n))})["catch"](function(e){console.error(n["default"].red("Error finding image: ",e))})}},function(e,i){e.exports=require("body-parser")},function(e,i){e.exports=require("chalk")},function(e,i){e.exports=require("express")},function(e,i){e.exports=require("sequelize")},function(e,i){e.exports=require("source-map-support/register")}]);
//# sourceMappingURL=server.js.map