!function(e){function s(i){if(t[i])return t[i].exports;var r=t[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}var t={};return s.m=e,s.c=t,s.p="/",s(0)}([function(e,s,t){e.exports=t(3)},function(e,s,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(s,"__esModule",{value:!0});var r=t(8),n=i(r),o=t(2),a=i(o),d=process.env.NODE_ENV||"development",l=void 0;l="production"===d?new n["default"](process.env.DATABASE_URL,{dialect:"postgres"}):new n["default"]("random_images","root","");var u={};u.like=l["import"](a["default"].resolve("./server/database/models/like.js")),u.usersIP=l["import"](a["default"].resolve("./server/database/models/usersIp.js")),u.Sequelize=n["default"],u.connection=l,s["default"]=u},function(e,s){e.exports=require("path")},function(e,s,t){"use strict";function i(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t]);return s["default"]=e,s}function r(e){return e&&e.__esModule?e:{"default":e}}t(9);var n=t(7),o=r(n),a=t(5),d=r(a),l=t(1),u=r(l),c=t(4),f=i(c),p=(0,o["default"])(),v=process.env.PORT||3e3;p.use(o["default"]["static"]("./dist")),p.use(d["default"].urlencoded({extended:!0})),p.use(d["default"].json()),p.all("/*",f.corsFix),p.get("/",f.home),p.post("/info",f.info),u["default"].connection.sync({}).then(function(){p.listen(v,function(e){if(e)throw new Error("Server fault: ",e);console.log("Server is listening on port:",v)})})},function(e,s,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(s,"__esModule",{value:!0}),s.info=s.home=s.corsFix=void 0;var r=t(2),n=i(r),o=t(6),a=i(o),d=t(1),l=i(d);s.corsFix=function(e,s,t){s.header("Access-Control-Allow-Origin","*"),s.header("Access-Control-Allow-Headers","X-Requested-With"),t()},s.home=function(e,s){s.sendFile(n["default"].resolve("./src/index.html"))},s.info=function(e,s){var t=e.body.imageId,i=e.body.ip,r=e.body.likePressed,n=e.body.dislikePressed;l["default"].like.findOne({where:{imageId:t}}).then(function(e){var o={likes:e?e.dataValues.likes:"0",dislikes:e?e.dataValues.dislikes:"0",views:e?e.dataValues.views:"1"};e?l["default"].usersIP.findAll({where:{imageId:t}}).then(function(t){var a=t.find(function(e){return i===e.dataValues.ip});a.dataValues.liked_disliked===!1?(r||n)&&(a.update({liked_disliked:!0}),e.update({likes:r?e.dataValues.likes+1:e.dataValues.likes,dislikes:n?e.dataValues.dislikes+1:e.dataValues.dislikes}).then(function(e){o.likes=e.dataValues.likes,o.dislikes=e.dataValues.dislikes,s.send(o)})):a||e.update({views:e.dataValues.views+1}).then(function(e){o.views=e.dataValues.views,s.send(o)})}):(l["default"].like.create({imageId:t,likes:0,dislikes:0,views:1}),l["default"].usersIP.create({imageId:t,ip:i,liked_disliked:!1}),s.send(o))})["catch"](function(e){console.log(a["default"].red("Error finding image: ",e))})}},function(e,s){e.exports=require("body-parser")},function(e,s){e.exports=require("chalk")},function(e,s){e.exports=require("express")},function(e,s){e.exports=require("sequelize")},function(e,s){e.exports=require("source-map-support/register")}]);
//# sourceMappingURL=server.js.map